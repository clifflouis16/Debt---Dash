<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Debt Dash">
  <title>Debt Dash v3.0 - FIXED VERSION</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    #root { min-height: 100vh; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback, memo } = React;
    
    // Inline Lucide icons as React components
    const Plus = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round", className: props.className }, React.createElement('path', { d: "M5 12h14" }), React.createElement('path', { d: "M12 5v14" }));
    
    const TrendingDown = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('polyline', { points: "22 17 13.5 8.5 8.5 13.5 2 7" }), React.createElement('polyline', { points: "16 17 22 17 22 11" }));
    
    const Wallet = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M21 12V7H5a2 2 0 0 1 0-4h14v4" }), React.createElement('path', { d: "M3 5v14a2 2 0 0 0 2 2h16v-5" }), React.createElement('path', { d: "M18 12a2 2 0 0 0 0 4h4v-4Z" }));
    
    const ChevronDown = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "m6 9 6 6 6-6" }));
    
    const ChevronUp = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "m18 15-6-6-6 6" }));
    
    const Download = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }), React.createElement('polyline', { points: "7 10 12 15 17 10" }), React.createElement('line', { x1: "12", x2: "12", y1: "15", y2: "3" }));
    
    const Upload = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }), React.createElement('polyline', { points: "17 8 12 3 7 8" }), React.createElement('line', { x1: "12", x2: "12", y1: "3", y2: "15" }));
    
    const DollarSign = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('line', { x1: "12", x2: "12", y1: "2", y2: "22" }), React.createElement('path', { d: "M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" }));
    
    const AlertCircle = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('circle', { cx: "12", cy: "12", r: "10" }), React.createElement('line', { x1: "12", x2: "12", y1: "8", y2: "12" }), React.createElement('line', { x1: "12", x2: "12.01", y1: "16", y2: "16" }));
    
    const Target = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('circle', { cx: "12", cy: "12", r: "10" }), React.createElement('circle', { cx: "12", cy: "12", r: "6" }), React.createElement('circle', { cx: "12", cy: "12", r: "2" }));
    
    const Zap = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('polygon', { points: "13 2 3 14 12 14 11 22 21 10 12 10 13 2" }));
    
    const History = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" }), React.createElement('path', { d: "M3 3v5h5" }), React.createElement('path', { d: "M12 7v5l4 2" }));
    
    const Calculator = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('rect', { width: "16", height: "20", x: "4", y: "2", rx: "2" }), React.createElement('line', { x1: "8", x2: "16", y1: "6", y2: "6" }), React.createElement('line', { x1: "16", x2: "16", y1: "14", y2: "18" }), React.createElement('path', { d: "M16 10h.01" }), React.createElement('path', { d: "M12 10h.01" }), React.createElement('path', { d: "M8 10h.01" }), React.createElement('path', { d: "M12 14h.01" }), React.createElement('path', { d: "M8 14h.01" }), React.createElement('path', { d: "M12 18h.01" }), React.createElement('path', { d: "M8 18h.01" }));
    
    const BarChart3 = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M3 3v18h18" }), React.createElement('path', { d: "M18 17V9" }), React.createElement('path', { d: "M13 17V5" }), React.createElement('path', { d: "M8 17v-3" }));
    
    const Flame = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" }));
    
    const X = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M18 6 6 18" }), React.createElement('path', { d: "m6 6 12 12" }));
    
    const Edit2 = (props) => React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", width: props.size || 24, height: props.size || 24, viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement('path', { d: "M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" }), React.createElement('path', { d: "m15 5 4 4" }));


// ============================================================================
// UTILITY FUNCTIONS - EXACT FINANCIAL CALCULATIONS
// ============================================================================

const formatCurrency = (amount) => {
  const num = parseFloat(amount) || 0;
  return num.toLocaleString('en-US', { 
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  });
};

const calculateMinPayment = (balance, rate, issuer = 'chase') => {
  const balanceNum = parseFloat(balance) || 0;
  const aprNum = parseFloat(rate) || 0;
  
  if (balanceNum === 0) return '0.00';
  
  // Calculate monthly interest charge (exact)
  const monthlyInterestRate = (aprNum / 100) / 12;
  const monthlyInterest = balanceNum * monthlyInterestRate;

  // Industry-standard minimum payment formulas (verified)
  if (issuer === 'chase') {
    // Chase: Greater of $40 OR (1% of balance + monthly interest)
    const percentagePlusInterest = (balanceNum * 0.01) + monthlyInterest;
    return Math.max(40, percentagePlusInterest).toFixed(2);
  }
  
  if (issuer === 'navyfed') {
    // Navy Federal: If balance < $20, pay full balance; else greater of $20 OR (1% of balance rounded up + interest)
    if (balanceNum < 20) return balanceNum.toFixed(2);
    const onePercent = Math.ceil(balanceNum * 0.01); // Round up to nearest dollar
    return Math.max(20, onePercent + monthlyInterest).toFixed(2);
  }
  
  if (issuer === 'discover') {
    // Discover: 2% of balance OR $35, whichever is greater (capped at full balance)
    const twoPercent = balanceNum * 0.02;
    return Math.min(Math.max(35, twoPercent), balanceNum).toFixed(2);
  }
  
  // Default/Other: 2% of balance OR $25, whichever is greater
  return Math.max(balanceNum * 0.02, 25).toFixed(2);
};

const calculatePayoffTimeline = (cards, monthlyPayment) => {
  if (!cards.length || monthlyPayment <= 0) return null;
  
  const simulatePayoff = (sortedCards) => {
    let months = 0;
    let totalInterest = 0;
    const cardsClone = sortedCards.map(c => ({ ...c }));
    
    // Simulate month by month
    while (cardsClone.some(c => c.balance > 0.01) && months < 600) {
      months++;
      let remainingPayment = monthlyPayment;
      
      // First, add interest to all cards with balance
      for (let card of cardsClone) {
        if (card.balance > 0) {
          const monthlyInterestRate = (card.apr / 100) / 12;
          const interest = card.balance * monthlyInterestRate;
          card.balance += interest;
          totalInterest += interest;
        }
      }
      
      // Then apply payments in priority order
      for (let card of cardsClone) {
        if (card.balance > 0 && remainingPayment > 0) {
          const payment = Math.min(remainingPayment, card.balance);
          card.balance -= payment;
          remainingPayment -= payment;
          
          // Clean up rounding errors
          if (card.balance < 0.01) card.balance = 0;
        }
      }
      
      // Safety check - if we're not making progress, break
      if (remainingPayment === monthlyPayment) break;
    }
    
    return { months, totalInterest };
  };
  
  // Deep clone cards for simulation
  const avalancheCards = cards.map(c => ({ 
    balance: parseFloat(c.balance), 
    apr: parseFloat(c.apr) 
  })).sort((a, b) => b.apr - a.apr); // Highest APR first
  
  const snowballCards = cards.map(c => ({ 
    balance: parseFloat(c.balance), 
    apr: parseFloat(c.apr) 
  })).sort((a, b) => a.balance - b.balance); // Smallest balance first
  
  return {
    avalanche: simulatePayoff(avalancheCards),
    snowball: simulatePayoff(snowballCards)
  };
};

const getCardSymbol = (index) => ['‚óè', '‚ñ†', '‚ñ≤', '‚óÜ', '‚òÖ', '‚ô¶', '‚ñº', '‚óâ', '‚óà', '‚óá'][index % 10];

const getCardColor = (index) => {
  const colors = [
    { bg: 'bg-rose-500', text: 'text-rose-400', border: 'border-rose-500', glow: 'shadow-rose-500' },
    { bg: 'bg-blue-500', text: 'text-blue-400', border: 'border-blue-500', glow: 'shadow-blue-500' },
    { bg: 'bg-emerald-500', text: 'text-emerald-400', border: 'border-emerald-500', glow: 'shadow-emerald-500' },
    { bg: 'bg-purple-500', text: 'text-purple-400', border: 'border-purple-500', glow: 'shadow-purple-500' },
    { bg: 'bg-amber-500', text: 'text-amber-400', border: 'border-amber-500', glow: 'shadow-amber-500' },
    { bg: 'bg-pink-500', text: 'text-pink-400', border: 'border-pink-500', glow: 'shadow-pink-500' },
    { bg: 'bg-teal-500', text: 'text-teal-400', border: 'border-teal-500', glow: 'shadow-teal-500' },
    { bg: 'bg-orange-500', text: 'text-orange-400', border: 'border-orange-500', glow: 'shadow-orange-500' },
    { bg: 'bg-indigo-500', text: 'text-indigo-400', border: 'border-indigo-500', glow: 'shadow-indigo-500' },
    { bg: 'bg-cyan-500', text: 'text-cyan-400', border: 'border-cyan-500', glow: 'shadow-cyan-500' }
  ];
  return colors[index % colors.length];
};

const validateNumber = (value, min = 0) => {
  const num = parseFloat(value);
  return !isNaN(num) && num >= min;
};

// Banking-style currency input hook
const useCurrencyInput = (initialValue = '0.00') => {
  const [displayValue, setDisplayValue] = React.useState(initialValue);
  const [rawCents, setRawCents] = React.useState(Math.round(parseFloat(initialValue) * 100));

  const handleKeyPress = (key) => {
    if (key >= '0' && key <= '9') {
      const newCents = rawCents * 10 + parseInt(key);
      setRawCents(newCents);
      const dollars = Math.floor(newCents / 100);
      const cents = newCents % 100;
      setDisplayValue(`${dollars}.${cents.toString().padStart(2, '0')}`);
    } else if (key === 'Backspace') {
      const newCents = Math.floor(rawCents / 10);
      setRawCents(newCents);
      const dollars = Math.floor(newCents / 100);
      const cents = newCents % 100;
      setDisplayValue(`${dollars}.${cents.toString().padStart(2, '0')}`);
    }
  };

  const reset = (value = '0.00') => {
    setRawCents(Math.round(parseFloat(value) * 100));
    setDisplayValue(value);
  };

  const getValue = () => displayValue;

  return { displayValue, handleKeyPress, reset, getValue };
};

const useLocalStorage = (key, initialValue) => {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch {
      return initialValue;
    }
  });

  const setValue = useCallback((value) => {
    try {
      const valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(key, JSON.stringify(valueToStore));
    } catch (error) {
      console.error(`Error saving ${key}:`, error);
    }
  }, [key, storedValue]);

  return [storedValue, setValue];
};

// ============================================================================
// UI COMPONENTS
// ============================================================================

// Banking-style currency input component
const BankingInput = memo(({ value, onChange, onEnter, label, placeholder = "0.00", className = "" }) => {
  const [rawCents, setRawCents] = React.useState(0);
  const [isFocused, setIsFocused] = React.useState(false);

  // Initialize from external value only when not focused
  React.useEffect(() => {
    if (!isFocused) {
      const cents = Math.round(parseFloat(value || 0) * 100);
      setRawCents(cents);
    }
  }, [value, isFocused]);

  const formatDisplay = (cents) => {
    const dollars = Math.floor(cents / 100);
    const centsRemainder = cents % 100;
    return `${dollars}.${centsRemainder.toString().padStart(2, '0')}`;
  };

  const handleKeyDown = (e) => {
    // Allow tab key for navigation
    if (e.key === 'Tab') return;
    
    e.preventDefault();
    
    if (e.key >= '0' && e.key <= '9') {
      const newCents = rawCents * 10 + parseInt(e.key);
      setRawCents(newCents);
      onChange(formatDisplay(newCents));
    } else if (e.key === 'Backspace' || e.key === 'Delete') {
      const newCents = Math.floor(rawCents / 10);
      setRawCents(newCents);
      onChange(formatDisplay(newCents));
    } else if (e.key === 'Enter' && onEnter) {
      onEnter();
      e.target.blur();
    } else if (e.key === 'Escape') {
      e.target.blur();
    }
  };

  const handleInput = (e) => {
    // Prevent any actual input changes
    e.preventDefault();
    return false;
  };

  const handleFocus = (e) => {
    setIsFocused(true);
    setRawCents(0); // Always start fresh at $0.00
    onChange('0.00');
    
    // Force numeric keyboard on mobile
    e.target.setAttribute('inputmode', 'numeric');
    e.target.setAttribute('pattern', '[0-9]*');
  };

  const handleBlur = () => {
    setIsFocused(false);
  };

  const displayValue = formatDisplay(rawCents);

  return (
    <div className="relative">
      {label && <label className="text-xs text-slate-400 block mb-1">{label}</label>}
      <div className="relative">
        <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xl font-bold pointer-events-none">$</span>
        <input
          type="tel"
          inputMode="numeric"
          pattern="[0-9]*"
          value={displayValue}
          onKeyDown={handleKeyDown}
          onInput={handleInput}
          onFocus={handleFocus}
          onBlur={handleBlur}
          placeholder={placeholder}
          autoComplete="off"
          className={`w-full bg-slate-900/50 border border-slate-700 rounded-lg px-3 pl-8 py-2 text-white font-mono text-xl font-bold focus:outline-none focus:ring-2 focus:ring-blue-500 ${className}`}
        />
      </div>
    </div>
  );
});

const Notification = memo(({ message, type }) => (
  <div className={`fixed top-4 right-4 left-4 sm:left-auto z-50 px-6 py-3 rounded-xl shadow-2xl border backdrop-blur-md animate-in slide-in-from-top duration-300 ${type === 'success' ? 'bg-emerald-500/90 border-emerald-400 text-white' : 'bg-rose-500/90 border-rose-400 text-white'}`}>
    <div className="flex items-center gap-2 font-medium">
      {type === 'success' ? <Zap size={18} /> : <AlertCircle size={18} />}
      {message}
    </div>
  </div>
));

const Modal = memo(({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-0" onClick={onClose}>
      <div className="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full h-full sm:w-auto sm:h-auto sm:max-w-2xl sm:max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
        <div className="sticky top-0 bg-slate-800 z-10 flex items-center justify-between p-4 sm:p-6 border-b border-slate-700">
          <h2 className="text-lg sm:text-xl font-bold text-white">{title}</h2>
          <button onClick={onClose} className="text-slate-400 hover:text-white p-2 rounded-lg transition-colors">
            <X size={24} />
          </button>
        </div>
        {children}
      </div>
    </div>
  );
});

// ============================================================================
// MODALS
// ============================================================================

const QuickEditModal = memo(({ isOpen, onClose, cards, onUpdateBalances }) => {
  const [editedBalances, setEditedBalances] = useState({});
  const [charges, setCharges] = useState({});

  useEffect(() => {
    if (isOpen) {
      const balances = {}, newCharges = {};
      cards.forEach(card => {
        balances[card.id] = card.balance;
        newCharges[card.id] = '';
      });
      setEditedBalances(balances);
      setCharges(newCharges);
    }
  }, [isOpen, cards]);

  const handleAddCharge = useCallback((cardId) => {
    const charge = parseFloat(charges[cardId]) || 0;
    if (charge > 0) {
      const currentBalance = parseFloat(editedBalances[cardId]) || 0;
      setEditedBalances(prev => ({ ...prev, [cardId]: (currentBalance + charge).toFixed(2) }));
      setCharges(prev => ({ ...prev, [cardId]: '' }));
    }
  }, [charges, editedBalances]);

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Update Balances">
      <div className="p-4 sm:p-6">
        <div className="space-y-4">
          {cards.map((card) => (
            <div key={card.id} className="bg-slate-900/50 rounded-xl p-4 border border-slate-700">
              <div className="font-semibold text-white mb-3">{card.name}</div>
              <div className="grid grid-cols-2 gap-3 mb-3">
                <div>
                  <label className="text-xs text-slate-400 block mb-1">Current</label>
                  <div className="text-slate-300">${parseFloat(card.balance).toFixed(2)}</div>
                </div>
                <div>
                  <BankingInput
                    label="New Balance"
                    value={editedBalances[card.id] || '0.00'}
                    onChange={(val) => setEditedBalances(prev => ({ ...prev, [card.id]: val }))}
                    onEnter={() => { onUpdateBalances(editedBalances); onClose(); }}
                  />
                </div>
              </div>
              <div className="pt-3 border-t border-slate-700/50">
                <BankingInput
                  label="Add Charge"
                  value={charges[card.id] || '0.00'}
                  onChange={(val) => setCharges(prev => ({ ...prev, [card.id]: val }))}
                  onEnter={() => handleAddCharge(card.id)}
                  className="text-sm"
                />
                <button onClick={() => handleAddCharge(card.id)} className="w-full mt-2 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm">+ Add Charge</button>
              </div>
            </div>
          ))}
        </div>
        <div className="flex gap-3 mt-6 pb-safe">
          <button onClick={onClose} className="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all">Cancel</button>
          <button onClick={() => { onUpdateBalances(editedBalances); onClose(); }} className="flex-1 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white py-3 rounded-xl font-semibold transition-all">Save All</button>
        </div>
      </div>
    </Modal>
  );
});

const FundsManagerModal = memo(({ isOpen, onClose, currentFunds, availableFunds, onUpdateFunds }) => {
  const [newSavingsGoal, setNewSavingsGoal] = useState('');
  const [newAvailableFunds, setNewAvailableFunds] = useState('');
  const [addToSavings, setAddToSavings] = useState('');
  const [addToAvailable, setAddToAvailable] = useState('');

  useEffect(() => {
    if (isOpen) {
      setNewSavingsGoal(currentFunds);
      setNewAvailableFunds(availableFunds);
      setAddToSavings('');
      setAddToAvailable('');
    }
  }, [isOpen, currentFunds, availableFunds]);

  const handleAddToSavings = useCallback(() => {
    const toAdd = parseFloat(addToSavings) || 0;
    if (toAdd > 0) {
      setNewSavingsGoal(((parseFloat(newSavingsGoal) || 0) + toAdd).toFixed(2));
      setAddToSavings('');
    }
  }, [addToSavings, newSavingsGoal]);

  const handleAddToAvailable = useCallback(() => {
    const toAdd = parseFloat(addToAvailable) || 0;
    if (toAdd > 0) {
      setNewAvailableFunds(((parseFloat(newAvailableFunds) || 0) + toAdd).toFixed(2));
      setAddToAvailable('');
    }
  }, [addToAvailable, newAvailableFunds]);

  if (!isOpen) return null;
  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-md" onClick={(e) => e.stopPropagation()}>
        <div className="flex items-center justify-between p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold text-white">Manage Account Balance</h2>
          <button onClick={onClose} className="text-slate-400 hover:text-white p-2 rounded-lg transition-colors"><X size={24} /></button>
        </div>
        <div className="p-6">
          <div className="space-y-6">
            <div>
              <label className="text-sm text-slate-300 mb-2 block font-semibold">For Debt Payment</label>
              <div className="text-xs text-slate-400 mb-2">Current: ${parseFloat(currentFunds).toFixed(2)}</div>
              <BankingInput
                value={newSavingsGoal}
                onChange={(val) => setNewSavingsGoal(val)}
                className="focus:ring-blue-500"
              />
              <div className="mt-3 pt-3 border-t border-slate-700/50">
                <BankingInput
                  label="+ Add More"
                  value={addToSavings}
                  onChange={(val) => setAddToSavings(val)}
                  onEnter={handleAddToSavings}
                  className="text-sm focus:ring-blue-500"
                />
                <button 
                  onClick={handleAddToSavings} 
                  className="w-full mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm"
                >
                  + Add
                </button>
              </div>
            </div>

            <div>
              <label className="text-sm text-slate-300 mb-2 block font-semibold">Total Available Funds</label>
              <div className="text-xs text-slate-400 mb-2">Current: ${parseFloat(availableFunds).toFixed(2)}</div>
              <BankingInput
                value={newAvailableFunds}
                onChange={(val) => setNewAvailableFunds(val)}
                className="focus:ring-teal-500"
              />
              <div className="mt-3 pt-3 border-t border-slate-700/50">
                <BankingInput
                  label="+ Add More"
                  value={addToAvailable}
                  onChange={(val) => setAddToAvailable(val)}
                  onEnter={handleAddToAvailable}
                  className="text-sm focus:ring-teal-500"
                />
                <button 
                  onClick={handleAddToAvailable} 
                  className="w-full mt-2 bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm"
                >
                  + Add
                </button>
              </div>
            </div>

            <div className="p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-xl">
              <div className="flex items-center justify-between">
                <span className="text-sm text-emerald-300 font-semibold">Free to Spend</span>
                <span className="text-lg font-bold text-emerald-400">
                  ${Math.max(0, (parseFloat(newAvailableFunds) || 0) - (parseFloat(newSavingsGoal) || 0)).toFixed(2)}
                </span>
              </div>
            </div>
          </div>
          <div className="flex gap-3 mt-6">
            <button onClick={onClose} className="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all">Cancel</button>
            <button onClick={() => { onUpdateFunds(newSavingsGoal, newAvailableFunds); onClose(); }} className="flex-1 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white py-3 rounded-xl font-semibold transition-all">Save Changes</button>
          </div>
        </div>
      </div>
    </div>
  );
});

const MakePaymentModal = memo(({ isOpen, onClose, cards, onMakePayment }) => {
  const [selectedCard, setSelectedCard] = useState('');
  const [paymentAmount, setPaymentAmount] = useState('');

  const handlePayment = useCallback(() => {
    if (selectedCard && paymentAmount && parseFloat(paymentAmount) > 0) {
      onMakePayment(selectedCard, parseFloat(paymentAmount));
      setSelectedCard('');
      setPaymentAmount('');
      onClose();
    }
  }, [selectedCard, paymentAmount, onMakePayment, onClose]);

  const selectedCardData = useMemo(() => cards.find(c => c.id === selectedCard), [cards, selectedCard]);

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Make a Payment">
      <div className="p-6 space-y-4">
        <div>
          <label className="text-sm text-slate-300 mb-2 block">Select Card</label>
          <select value={selectedCard} onChange={(e) => setSelectedCard(e.target.value)} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white">
            <option value="">Choose...</option>
            {cards.map(card => <option key={card.id} value={card.id}>{card.name} - ${parseFloat(card.balance).toFixed(2)}</option>)}
          </select>
        </div>
        {selectedCard && (
          <div>
            <BankingInput
              label="Payment Amount"
              value={paymentAmount}
              onChange={(val) => setPaymentAmount(val)}
              onEnter={() => {
                if (selectedCard && paymentAmount && parseFloat(paymentAmount) > 0) {
                  handlePayment();
                }
              }}
            />
            {selectedCardData && (
              <div className="mt-3 space-y-2">
                <div className="text-xs text-slate-400">Min: ${calculateMinPayment(selectedCardData.balance, selectedCardData.apr, selectedCardData.issuer)} ‚Ä¢ Balance: ${parseFloat(selectedCardData.balance).toFixed(2)}</div>
                <div className="flex gap-2">
                  <button 
                    onClick={() => setPaymentAmount(calculateMinPayment(selectedCardData.balance, selectedCardData.apr, selectedCardData.issuer))}
                    className="flex-1 bg-slate-700 hover:bg-slate-600 text-white px-3 py-2 rounded-lg text-xs font-semibold transition-colors"
                  >
                    Min Payment
                  </button>
                  <button 
                    onClick={() => setPaymentAmount(selectedCardData.balance)}
                    className="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 rounded-lg text-xs font-semibold transition-colors"
                  >
                    Pay Full Balance
                  </button>
                </div>
              </div>
            )}
          </div>
        )}
        <button onClick={handlePayment} disabled={!selectedCard || !paymentAmount} className="w-full bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 disabled:from-slate-600 disabled:to-slate-600 disabled:cursor-not-allowed text-white py-3 rounded-xl font-semibold transition-all">Record Payment</button>
      </div>
    </Modal>
  );
});

const PayoffCalculatorModal = memo(({ isOpen, onClose, cards, monthlyBudget, setMonthlyBudget, totalMinPayment }) => {
  const [calculatorBudget, setCalculatorBudget] = useState(monthlyBudget);
  useEffect(() => { setCalculatorBudget(monthlyBudget); }, [monthlyBudget]);
  const timeline = useMemo(() => calculatePayoffTimeline(cards, parseFloat(calculatorBudget) || 0), [cards, calculatorBudget]);

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Payoff Calculator">
      <div className="p-6 space-y-6">
        <div>
          <label className="text-sm text-slate-300 mb-2 block">Monthly Payment Budget</label>
          <input type="number" value={calculatorBudget} onChange={(e) => setCalculatorBudget(e.target.value)} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white" placeholder="Enter amount" />
          <div className="text-xs text-slate-400 mt-2">Min required: ${totalMinPayment.toFixed(2)}</div>
        </div>
        {timeline && (
          <div className="space-y-4">
            <div className="bg-emerald-500/10 rounded-xl p-4 border border-emerald-500/30">
              <div className="flex items-center gap-2 mb-2"><Flame className="text-emerald-400" size={20} /><h3 className="font-semibold text-emerald-300">Avalanche</h3></div>
              <div className="text-xs text-slate-400 mb-3">Highest APR first</div>
              <div className="grid grid-cols-2 gap-3">
                <div><div className="text-xs text-slate-400">Payoff Time</div><div className="text-2xl font-bold text-white">{Math.floor(timeline.avalanche.months / 12)}y {timeline.avalanche.months % 12}m</div></div>
                <div><div className="text-xs text-slate-400">Total Interest</div><div className="text-2xl font-bold text-white">${timeline.avalanche.totalInterest.toFixed(2)}</div></div>
              </div>
            </div>
            <div className="bg-blue-500/10 rounded-xl p-4 border border-blue-500/30">
              <div className="flex items-center gap-2 mb-2"><Target className="text-blue-400" size={20} /><h3 className="font-semibold text-blue-300">Snowball</h3></div>
              <div className="text-xs text-slate-400 mb-3">Smallest balance first</div>
              <div className="grid grid-cols-2 gap-3">
                <div><div className="text-xs text-slate-400">Payoff Time</div><div className="text-2xl font-bold text-white">{Math.floor(timeline.snowball.months / 12)}y {timeline.snowball.months % 12}m</div></div>
                <div><div className="text-xs text-slate-400">Total Interest</div><div className="text-2xl font-bold text-white">${timeline.snowball.totalInterest.toFixed(2)}</div></div>
              </div>
            </div>
            <div className="bg-slate-900/50 rounded-xl p-4 border border-slate-700">
              <div className="text-sm font-semibold text-white mb-2">Recommendation</div>
              <div className="text-sm text-slate-300">{timeline.avalanche.totalInterest < timeline.snowball.totalInterest ? <><span className="text-emerald-400 font-semibold">Avalanche</span> saves ${(timeline.snowball.totalInterest - timeline.avalanche.totalInterest).toFixed(2)}</> : <><span className="text-blue-400 font-semibold">Snowball</span> for quick wins</>}</div>
            </div>
          </div>
        )}
        <button onClick={() => { setMonthlyBudget(calculatorBudget); onClose(); }} className="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white py-3 rounded-xl font-semibold transition-all">Save Budget</button>
      </div>
    </Modal>
  );
});

const InsightsModal = memo(({ isOpen, onClose, cards, stats }) => {
  const highestAPR = useMemo(() => cards.length ? cards.reduce((h, c) => (parseFloat(c.apr) > parseFloat(h.apr) ? c : h)) : null, [cards]);
  const highestBalance = useMemo(() => cards.length ? cards.reduce((h, c) => (parseFloat(c.balance) > parseFloat(h.balance) ? c : h)) : null, [cards]);
  const highestUtil = useMemo(() => cards.length ? cards.reduce((h, c) => {
    const util = parseFloat(c.creditLimit) > 0 ? (parseFloat(c.balance) / parseFloat(c.creditLimit)) * 100 : 0;
    const hUtil = parseFloat(h.creditLimit) > 0 ? (parseFloat(h.balance) / parseFloat(h.creditLimit)) * 100 : 0;
    return util > hUtil ? c : h;
  }) : null, [cards]);

  const today = new Date();
  const currentMonth = today.getMonth();
  const currentYear = today.getFullYear();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
  const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
  
  const calendarDates = useMemo(() => {
    const dates = [];
    for (let i = 0; i < firstDayOfMonth; i++) dates.push(null);
    for (let i = 1; i <= daysInMonth; i++) dates.push(i);
    return dates;
  }, [firstDayOfMonth, daysInMonth]);

  const getEventsForDay = useCallback((day) => {
    if (!day) return [];
    const events = [];
    cards.forEach((card, idx) => {
      if (card.dueDate) {
        const dueDate = new Date(card.dueDate);
        if (dueDate.getMonth() === currentMonth && dueDate.getFullYear() === currentYear && dueDate.getDate() === day) {
          events.push({ type: 'due', card: card.name, color: getCardColor(idx), cardIndex: idx });
        }
      }
      if (card.closeDate) {
        const closeDate = new Date(card.closeDate);
        if (closeDate.getMonth() === currentMonth && closeDate.getFullYear() === currentYear && closeDate.getDate() === day) {
          events.push({ type: 'close', card: card.name, color: getCardColor(idx), cardIndex: idx });
        }
      }
    });
    return events;
  }, [cards, currentMonth, currentYear]);

  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Insights">
      <div className="p-4 sm:p-6 space-y-6">
        <div className="bg-slate-900/50 rounded-2xl p-5 border border-slate-700/50">
          <div className="space-y-3">
            <div className="flex justify-between items-center"><span className="text-slate-400 text-sm">Total Debt</span><span className="text-white font-semibold text-lg">${stats.totalDebt.toFixed(2)}</span></div>
            <div className="flex justify-between items-center"><span className="text-slate-400 text-sm">Monthly Interest</span><span className="text-amber-400 font-semibold text-lg">${stats.totalMonthlyInterest.toFixed(2)}</span></div>
            <div className="flex justify-between items-center"><span className="text-slate-400 text-sm">Yearly Cost</span><span className="text-rose-400 font-semibold text-lg">${(stats.totalMonthlyInterest * 12).toFixed(2)}</span></div>
            <div className="flex justify-between items-center"><span className="text-slate-400 text-sm">Credit Utilization</span><span className={`font-semibold text-lg ${stats.overallUtilization > 30 ? 'text-rose-400' : 'text-teal-400'}`}>{stats.overallUtilization.toFixed(1)}%</span></div>
          </div>
        </div>

        {highestAPR && <div className="bg-gradient-to-br from-rose-500/10 to-rose-600/5 rounded-2xl p-5 border border-rose-500/20"><div className="flex items-start justify-between mb-3"><h3 className="font-semibold text-rose-300">Highest APR</h3><span className="text-xs text-rose-400/60">‚ö†Ô∏è</span></div><div className="text-white font-semibold mb-1">{highestAPR.name}</div><div className="text-rose-400 text-3xl font-bold">{parseFloat(highestAPR.apr).toFixed(2)}%</div><div className="text-xs text-slate-400 mt-2">Priority target for payoff</div></div>}
        
        {highestBalance && <div className="bg-gradient-to-br from-blue-500/10 to-blue-600/5 rounded-2xl p-5 border border-blue-500/20"><div className="flex items-start justify-between mb-3"><h3 className="font-semibold text-blue-300">Largest Balance</h3><span className="text-xs text-blue-400/60">üí∞</span></div><div className="text-white font-semibold mb-1">{highestBalance.name}</div><div className="text-blue-400 text-3xl font-bold">${parseFloat(highestBalance.balance).toFixed(2)}</div></div>}
        
        {highestUtil && parseFloat(highestUtil.creditLimit) > 0 && <div className="bg-gradient-to-br from-amber-500/10 to-amber-600/5 rounded-2xl p-5 border border-amber-500/20"><div className="flex items-start justify-between mb-3"><h3 className="font-semibold text-amber-300">Highest Utilization</h3><span className="text-xs text-amber-400/60">üìä</span></div><div className="text-white font-semibold mb-1">{highestUtil.name}</div><div className="text-amber-400 text-3xl font-bold">{((parseFloat(highestUtil.balance) / parseFloat(highestUtil.creditLimit)) * 100).toFixed(1)}%</div><div className="text-xs text-slate-400 mt-2">Keep under 30% for better score</div></div>}
        
        <div className="bg-gradient-to-br from-teal-500/10 to-teal-600/5 rounded-2xl p-5 border border-teal-500/20"><h3 className="font-semibold text-teal-300 mb-4 flex items-center gap-2"><span>üí°</span> Financial Tips</h3><ul className="space-y-2.5 text-sm text-slate-300"><li className="flex items-start gap-2"><span className="text-teal-400 mt-0.5">‚Ä¢</span><span>Pay more than the minimum to reduce interest</span></li><li className="flex items-start gap-2"><span className="text-teal-400 mt-0.5">‚Ä¢</span><span>Keep utilization below 30% on all cards</span></li><li className="flex items-start gap-2"><span className="text-teal-400 mt-0.5">‚Ä¢</span><span>Consider balance transfers for high APR cards</span></li><li className="flex items-start gap-2"><span className="text-teal-400 mt-0.5">‚Ä¢</span><span>Set up automatic payments to avoid fees</span></li></ul></div>

        {cards.length > 0 && (
          <div className="bg-slate-900/50 rounded-2xl p-4 border border-slate-700/50">
            <h3 className="text-sm font-semibold text-slate-400 mb-3">Your Cards</h3>
            <div className="grid grid-cols-2 gap-2">
              {cards.map((card, idx) => {
                const color = getCardColor(idx);
                return (
                  <div key={card.id} className="flex items-center gap-2">
                    <div className={`w-3 h-3 rounded-full ${color.bg}`}></div>
                    <span className="text-xs text-slate-300 truncate">{card.name}</span>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        <div className="bg-gradient-to-b from-slate-900/80 to-slate-900/50 rounded-3xl p-6 border border-slate-700/30 shadow-2xl">
          <div className="mb-6">
            <h3 className="text-2xl font-semibold text-white mb-1">{monthNames[currentMonth]}</h3>
            <p className="text-slate-400 text-sm">{currentYear}</p>
          </div>
          
          <div className="grid grid-cols-7 gap-2 mb-3">
            {['S', 'M', 'T', 'W', 'T', 'F', 'S'].map((day, i) => (
              <div key={i} className="text-center text-xs font-medium text-slate-500 pb-2">{day}</div>
            ))}
          </div>
          
          <div className="grid grid-cols-7 gap-2">
            {calendarDates.map((day, idx) => {
              const events = getEventsForDay(day);
              const isToday = day === today.getDate();
              
              return (
                <div key={idx} className="relative aspect-square">
                  {day ? (
                    <div className={`w-full h-full flex flex-col items-center justify-center rounded-2xl transition-all duration-200 ${isToday ? 'bg-cyan-500 shadow-lg shadow-cyan-500/30' : events.length > 0 ? 'bg-slate-800/80 hover:bg-slate-700/80' : 'hover:bg-slate-800/40'}`}>
                      <span className={`text-sm font-medium ${isToday ? 'text-white' : events.length > 0 ? 'text-white' : 'text-slate-400'}`}>{day}</span>
                      {events.length > 0 && (
                        <div className="flex gap-0.5 mt-1 flex-wrap justify-center">
                          {events.map((event, i) => (
                            <div key={i} className={`w-1.5 h-1.5 rounded-full ${event.color.bg}`} title={`${event.card} - ${event.type === 'due' ? 'Payment Due' : 'Statement Close'}`}></div>
                          ))}
                        </div>
                      )}
                    </div>
                  ) : (
                    <div className="w-full h-full"></div>
                  )}
                </div>
              );
            })}
          </div>

          {cards.some(c => c.dueDate || c.closeDate) && (
            <div className="mt-6 pt-6 border-t border-slate-700/50">
              <div className="mb-4">
                <h4 className="text-sm font-semibold text-white mb-3">What the dots mean:</h4>
                <div className="space-y-2">
                  <div className="flex items-center gap-3 p-2 bg-rose-500/10 rounded-lg border border-rose-500/20">
                    <div className="flex items-center gap-2">
                      <div className="w-2 h-2 rounded-full bg-rose-500"></div>
                      <span className="text-base">‚óè</span>
                    </div>
                    <div>
                      <div className="text-sm font-semibold text-rose-300">Payment Due</div>
                      <div className="text-xs text-slate-400">Pay your bill by this date</div>
                    </div>
                  </div>
                  <div className="flex items-center gap-3 p-2 bg-blue-500/10 rounded-lg border border-blue-500/20">
                    <div className="flex items-center gap-2">
                      <div className="w-2 h-2 rounded-full bg-blue-500"></div>
                      <span className="text-base">‚óã</span>
                    </div>
                    <div>
                      <div className="text-sm font-semibold text-blue-300">Statement Closes</div>
                      <div className="text-xs text-slate-400">Billing cycle ends (stop spending)</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="space-y-2 max-h-40 overflow-y-auto">
                {cards.filter(c => c.dueDate || c.closeDate).map((card, idx) => {
                  const color = getCardColor(idx);
                  return (
                    <div key={card.id} className="flex items-center justify-between p-3 bg-slate-800/40 rounded-xl hover:bg-slate-800/60 transition-all">
                      <div className="flex items-center gap-3">
                        <div className={`w-3 h-3 rounded-full ${color.bg} shadow-sm`}></div>
                        <span className="text-sm font-medium text-white">{card.name}</span>
                      </div>
                      <div className="flex items-center gap-3 text-xs">
                        {card.dueDate && (
                          <div className="flex items-center gap-1.5 bg-rose-500/20 px-2.5 py-1.5 rounded-lg border border-rose-500/30">
                            <span className={`${color.text} text-base font-bold`}>‚óè</span>
                            <span className="text-rose-300 font-semibold">Due: {new Date(card.dueDate).getDate()}</span>
                          </div>
                        )}
                        {card.closeDate && (
                          <div className="flex items-center gap-1.5 bg-blue-500/20 px-2.5 py-1.5 rounded-lg border border-blue-500/30">
                            <span className={`${color.text} text-base`}>‚óã</span>
                            <span className="text-blue-300">Close: {new Date(card.closeDate).getDate()}</span>
                          </div>
                        )}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          )}
        </div>
        
        <button onClick={onClose} className="w-full bg-slate-800/80 hover:bg-slate-700/80 text-white py-4 rounded-2xl font-semibold transition-all backdrop-blur-sm border border-slate-700/50">Close</button>
      </div>
    </Modal>
  );
});

const HistoryModal = memo(({ isOpen, onClose, history }) => (
  <Modal isOpen={isOpen} onClose={onClose} title="Payment History">
    <div className="p-6">{history.length === 0 ? <div className="text-center py-8 text-slate-400">No payments yet</div> : <div className="space-y-3">{history.map((p) => <div key={p.id} className="bg-slate-900/50 rounded-xl p-4 border border-slate-700"><div className="flex justify-between mb-2"><div className="font-semibold text-white">{p.cardName}</div><div className="text-emerald-400 font-bold">-${p.amount.toFixed(2)}</div></div><div className="text-sm text-slate-400">{new Date(p.date).toLocaleDateString()} ‚Ä¢ ${p.oldBalance.toFixed(2)} ‚Üí ${p.newBalance.toFixed(2)}</div></div>)}</div>}</div>
  </Modal>
));

const ExportModal = memo(({ isOpen, onClose, data }) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(data);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      // Fallback for browsers that don't support clipboard API
      const textArea = document.createElement('textarea');
      textArea.value = data;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      } catch (e) {
        console.error('Copy failed:', e);
      }
      document.body.removeChild(textArea);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-hidden" onClick={(e) => e.stopPropagation()}>
        <div className="flex items-center justify-between p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold text-white">üì§ Export Backup</h2>
          <button onClick={onClose} className="text-slate-400 hover:text-white p-2 rounded-lg transition-colors">
            <X size={24} />
          </button>
        </div>
        
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
          <div className="mb-4">
            <p className="text-slate-300 text-sm mb-2">
              ‚úÖ Your backup is ready! Copy this text and save it in your Notes app.
            </p>
            <p className="text-slate-400 text-xs">
              üí° To restore later: Copy from Notes ‚Üí Click Import ‚Üí Paste
            </p>
          </div>

          <div className="relative">
            <textarea
              value={data}
              readOnly
              onClick={(e) => e.target.select()}
              className="w-full h-64 bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-slate-300 text-xs font-mono resize-none focus:outline-none focus:ring-2 focus:ring-cyan-500"
              placeholder="Backup data..."
            />
            <div className="absolute top-2 right-2">
              <button
                onClick={handleCopy}
                className={`${copied ? 'bg-emerald-600' : 'bg-slate-700 hover:bg-slate-600'} text-white px-3 py-1.5 rounded-lg text-xs font-semibold transition-all`}
              >
                {copied ? '‚úÖ Copied!' : 'üìã Copy'}
              </button>
            </div>
          </div>
        </div>

        <div className="flex gap-3 p-6 pt-0">
          <button
            onClick={handleCopy}
            className={`flex-1 ${copied ? 'bg-emerald-600' : 'bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700'} text-white py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2`}
          >
            {copied ? '‚úÖ Copied to Clipboard!' : 'üìã Copy to Clipboard'}
          </button>
          <button
            onClick={onClose}
            className="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
});

const ImportModal = memo(({ isOpen, onClose, onImport }) => {
  const [pasteData, setPasteData] = useState('');
  const [error, setError] = useState('');

  const handlePaste = async () => {
    try {
      const text = await navigator.clipboard.readText();
      setPasteData(text);
      setError('');
    } catch (err) {
      setError('üìã Could not read clipboard. Please paste manually into the box below.');
    }
  };

  const handleImport = () => {
    if (!pasteData.trim()) {
      setError('‚ö†Ô∏è Please paste your backup data first.');
      return;
    }
    
    try {
      const data = JSON.parse(pasteData);
      if (!data.cards && !data.savingsGoal && !data.paymentHistory) {
        setError('‚ö†Ô∏è Invalid backup data. Make sure you copied the complete backup.');
        return;
      }
      onImport(data);
      setPasteData('');
      setError('');
      onClose();
    } catch (err) {
      setError('‚ùå Invalid backup format. Please check your data and try again.');
    }
  };

  const handleClose = () => {
    setPasteData('');
    setError('');
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div className="bg-slate-800 rounded-2xl shadow-2xl border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-hidden" onClick={(e) => e.stopPropagation()}>
        <div className="flex items-center justify-between p-6 border-b border-slate-700">
          <h2 className="text-xl font-bold text-white">üì• Import Backup</h2>
          <button onClick={handleClose} className="text-slate-400 hover:text-white p-2 rounded-lg transition-colors">
            <X size={24} />
          </button>
        </div>
        
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
          <div className="mb-4">
            <p className="text-slate-300 text-sm mb-2">
              üìã Paste your backup data from Notes app below to restore your cards and funds.
            </p>
            <p className="text-slate-400 text-xs">
              üí° Copy the backup from Notes ‚Üí Paste here ‚Üí Click Restore
            </p>
          </div>

          <textarea
            value={pasteData}
            onChange={(e) => {
              setPasteData(e.target.value);
              setError('');
            }}
            placeholder="Paste your backup data here..."
            className="w-full h-64 bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-slate-300 text-xs font-mono resize-none focus:outline-none focus:ring-2 focus:ring-cyan-500"
          />

          {error && (
            <div className="mt-3 p-3 bg-rose-500/10 border border-rose-500/30 rounded-lg text-rose-300 text-sm flex items-start gap-2">
              <AlertCircle size={16} className="flex-shrink-0 mt-0.5" />
              <span>{error}</span>
            </div>
          )}

          {pasteData && !error && (
            <div className="mt-3 p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-lg text-emerald-300 text-sm flex items-center gap-2">
              <Zap size={16} />
              <span>‚úÖ Backup data detected! Click "Restore Data" to import.</span>
            </div>
          )}
        </div>

        <div className="flex gap-3 p-6 pt-0">
          <button
            onClick={handlePaste}
            className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2"
          >
            üìã Paste from Clipboard
          </button>
          <button
            onClick={handleImport}
            disabled={!pasteData}
            className={`flex-1 ${pasteData ? 'bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700' : 'bg-slate-600 cursor-not-allowed'} text-white py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2`}
          >
            ‚úÖ Restore Data
          </button>
        </div>
        
        <div className="px-6 pb-6">
          <button
            onClick={handleClose}
            className="w-full bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
});

const CardItem = memo(({ card, index, onToggle, isExpanded, onDelete, showDeleteConfirm, onConfirmDelete }) => {
  const [isEditingBalance, setIsEditingBalance] = React.useState(false);
  const [editBalance, setEditBalance] = React.useState(card.balance);
  
  const minPayment = useMemo(() => calculateMinPayment(card.balance, card.apr, card.issuer), [card.balance, card.apr, card.issuer]);
  const monthlyInterest = useMemo(() => {
    const balance = parseFloat(card.balance) || 0;
    const apr = parseFloat(card.apr) || 0;
    const monthlyRate = (apr / 100) / 12;
    return balance * monthlyRate;
  }, [card.balance, card.apr]);
  
  const creditLimit = parseFloat(card.creditLimit) || 0;
  const cardBalance = parseFloat(card.balance) || 0;
  const utilization = useMemo(() => creditLimit > 0 ? ((cardBalance / creditLimit) * 100) : 0, [creditLimit, cardBalance]);
  
  const cardColor = getCardColor(index);

  return (
    <div className={`bg-gradient-to-br from-slate-900/98 to-slate-800/98 backdrop-blur-xl rounded-2xl shadow-xl overflow-hidden border ${cardColor.border}/15 hover:${cardColor.border}/30 hover:shadow-${cardColor.glow}/5 transition-all`}>
      <div className="bg-slate-900/50 px-5 py-4 border-b border-slate-700/50">
        <div className="flex items-center justify-between mb-2">
          <div className="flex items-center gap-3 flex-1 min-w-0">
            <div className={`w-10 h-10 rounded-lg bg-gradient-to-br ${cardColor.bg}/20 flex items-center justify-center border ${cardColor.border}/30`}><span className={`text-xl ${cardColor.text}`}>{getCardSymbol(index)}</span></div>
            <div className="flex-1 min-w-0">
              <div className="font-semibold text-slate-100 truncate">{card.name}</div>
              <div className="text-slate-400 text-xs flex items-center gap-2">
                <span>{card.apr}% APR</span>
                {card.dueDate && (() => {
                  const today = new Date();
                  const due = new Date(card.dueDate);
                  const diffTime = due - today;
                  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                  if (diffDays >= 0 && diffDays <= 7) {
                    return <span className="text-rose-400 font-semibold">‚Ä¢ Due in {diffDays}d</span>;
                  } else if (diffDays > 7 && diffDays <= 14) {
                    return <span className="text-amber-400">‚Ä¢ Due in {diffDays}d</span>;
                  }
                  return null;
                })()}
              </div>
            </div>
          </div>
          <button className="text-slate-400 hover:text-slate-300 p-2 rounded-lg transition-colors" onClick={() => onToggle(card.id)}>{isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}</button>
        </div>
        <div className="text-3xl font-bold text-white mb-2 group/balance cursor-pointer" onClick={(e) => { e.stopPropagation(); setIsEditingBalance(true); }}>
          {isEditingBalance ? (
            <input
              type="number"
              value={editBalance}
              onChange={(e) => setEditBalance(e.target.value)}
              onBlur={() => {
                if (validateNumber(editBalance, 0)) {
                  card.balance = parseFloat(editBalance).toFixed(2);
                  window.dispatchEvent(new Event('storage'));
                }
                setIsEditingBalance(false);
              }}
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  if (validateNumber(editBalance, 0)) {
                    card.balance = parseFloat(editBalance).toFixed(2);
                    window.dispatchEvent(new Event('storage'));
                  }
                  setIsEditingBalance(false);
                }
              }}
              autoFocus
              className={`w-full bg-slate-800 border-2 ${cardColor.border} rounded-lg px-2 py-1 text-white text-3xl font-bold focus:outline-none focus:ring-2 focus:ring-${cardColor.border}`}
              step="0.01"
            />
          ) : (
            <span className={`group-hover/balance:${cardColor.text} transition-colors`}>${formatCurrency(cardBalance)}</span>
          )}
        </div>
        {utilization > 0 && creditLimit > 0 && (
          <div className="mt-2">
            <div className="flex items-center justify-between text-xs mb-1"><span className="text-slate-400 truncate">Using ${cardBalance.toFixed(2)} of ${creditLimit.toFixed(2)}</span><span className={`font-semibold ml-2 ${utilization > 30 ? 'text-rose-400' : 'text-teal-400'}`}>{utilization.toFixed(1)}%</span></div>
            <div className="w-full bg-slate-700/50 rounded-full h-1.5 shadow-inner"><div className={`h-1.5 rounded-full transition-all shadow-lg ${utilization > 30 ? 'bg-gradient-to-r from-rose-500 to-orange-500 shadow-rose-500/50' : `bg-gradient-to-r ${cardColor.bg} ${cardColor.glow}/50`}`} style={{ width: `${Math.min(utilization, 100)}%` }} /></div>
          </div>
        )}
      </div>
      {isExpanded && (
        <div className="p-5">
          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className={`${cardColor.bg}/10 rounded-xl p-4 border ${cardColor.border}/20`}><div className={`text-xs ${cardColor.text} mb-1.5`}>Min Payment</div><div className={`font-bold text-lg text-white`}>${minPayment}</div></div>
            <div className="bg-amber-500/10 rounded-xl p-4 border border-amber-500/20"><div className="text-xs text-amber-300 mb-1.5">Monthly Interest</div><div className="font-bold text-amber-100 text-lg">${monthlyInterest.toFixed(2)}</div></div>
          </div>
          {cardBalance > 0 && parseFloat(minPayment) > 0 && (
            <div className="mb-4 p-4 bg-blue-500/10 rounded-xl border border-blue-500/20">
              <div className="text-xs text-blue-300 mb-1">If Paid Minimum Only</div>
              <div className="font-bold text-blue-100 text-lg">
                {(() => {
                  let balance = cardBalance;
                  let months = 0;
                  const apr = parseFloat(card.apr) || 0;
                  const monthlyRate = (apr / 100) / 12;
                  const minPay = parseFloat(minPayment);
                  while (balance > 0.01 && months < 600) {
                    const interest = balance * monthlyRate;
                    balance += interest;
                    const payment = Math.min(minPay, balance);
                    balance -= payment;
                    months++;
                  }
                  const years = Math.floor(months / 12);
                  const remainingMonths = months % 12;
                  return years > 0 ? `${years}y ${remainingMonths}m` : `${remainingMonths}m`;
                })()}
              </div>
            </div>
          )}
          {creditLimit > 0 && <div className="mb-4 p-4 bg-slate-900/50 rounded-xl border border-slate-700/50"><div className="flex justify-between"><div><div className="text-xs text-slate-400 mb-1">Available</div><div className={`text-2xl font-bold ${cardColor.text}`}>${(creditLimit - cardBalance).toFixed(2)}</div></div><div className="text-right"><div className="text-xs text-slate-400 mb-1">Limit</div><div className="text-lg font-semibold text-slate-300">${creditLimit.toFixed(2)}</div></div></div></div>}
          {showDeleteConfirm === card.id ? <div className="flex gap-3"><button onClick={() => onConfirmDelete(card.id)} className="flex-1 bg-rose-600 hover:bg-rose-700 text-white font-semibold py-3 rounded-xl">Confirm Delete</button><button onClick={() => onDelete(null)} className="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 rounded-xl">Cancel</button></div> : <button onClick={() => onDelete(card.id)} className="text-sm text-rose-400 hover:text-rose-300 font-semibold py-2">Remove Card</button>}
        </div>
      )}
    </div>
  );
});

// ============================================================================
// MAIN APP
// ============================================================================

export default function DebtDash() {
  const [cards, setCards] = useLocalStorage('debt-cards', []);
  const [monthlyPaymentBudget, setMonthlyPaymentBudget] = useLocalStorage('monthly-payment-budget', '0');
  const [paymentHistory, setPaymentHistory] = useLocalStorage('payment-history', []);
  const [savingsGoal, setSavingsGoal] = useLocalStorage('savings-goal', '0');
  const [availableFunds, setAvailableFunds] = useLocalStorage('available-funds', '0');
  const [isAdding, setIsAdding] = useState(false);
  const [expandedCard, setExpandedCard] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);
  const [showQuickEdit, setShowQuickEdit] = useState(false);
  const [showFundsManager, setShowFundsManager] = useState(false);
  const [showMakePayment, setShowMakePayment] = useState(false);
  const [showHistory, setShowHistory] = useState(false);
  const [showCalculator, setShowCalculator] = useState(false);
  const [showInsights, setShowInsights] = useState(false);
  const [showExportModal, setShowExportModal] = useState(false);
  const [showImportModal, setShowImportModal] = useState(false);
  const [exportData, setExportData] = useState('');
  const [notification, setNotification] = useState(null);
  const [newCard, setNewCard] = useState({ name: '', balance: '', creditLimit: '', apr: '', issuer: 'chase', dueDate: '', closeDate: '' });

  const showNotification = useCallback((message, type = 'success') => {
    setNotification({ message, type });
    setTimeout(() => setNotification(null), 3000);
  }, []);

  const stats = useMemo(() => {
    const totalDebt = cards.reduce((s, c) => s + parseFloat(c.balance || 0), 0);
    const totalMinPayment = cards.reduce((s, c) => s + parseFloat(calculateMinPayment(c.balance, c.apr, c.issuer || 'chase')), 0);
    const totalMonthlyInterest = cards.reduce((s, c) => {
      const balance = parseFloat(c.balance || 0);
      const apr = parseFloat(c.apr || 0);
      const monthlyRate = (apr / 100) / 12;
      return s + (balance * monthlyRate);
    }, 0);
    const totalCreditLimit = cards.reduce((s, c) => s + (parseFloat(c.creditLimit) || 0), 0);
    const overallUtilization = totalCreditLimit > 0 ? (totalDebt / totalCreditLimit) * 100 : 0;
    return { totalDebt, totalMinPayment, totalMonthlyInterest, totalCreditLimit, overallUtilization };
  }, [cards]);

  const handleUpdateBalances = useCallback((newBalances) => {
    const updatedCards = cards.map(card => {
      const newBalance = parseFloat(newBalances[card.id]) || 0;
      const oldBalance = parseFloat(card.balance) || 0;
      if (newBalance !== oldBalance && newBalance < oldBalance) {
        setPaymentHistory(prev => [{ id: Date.now() + Math.random(), cardName: card.name, oldBalance, newBalance, amount: oldBalance - newBalance, date: new Date().toISOString() }, ...prev]);
      }
      return { ...card, balance: newBalance.toFixed(2) };
    });
    setCards(updatedCards);
    showNotification('Balances updated!');
  }, [cards, setCards, setPaymentHistory, showNotification]);

  const handleMakePayment = useCallback((cardId, amount) => {
    const card = cards.find(c => c.id === cardId);
    if (!card) return;
    const oldBalance = parseFloat(card.balance);
    const newBalance = Math.max(0, oldBalance - amount);
    setCards(prev => prev.map(c => c.id === cardId ? { ...c, balance: newBalance.toFixed(2) } : c));
    setPaymentHistory(prev => [{ id: Date.now(), cardName: card.name, oldBalance, newBalance, amount, date: new Date().toISOString() }, ...prev]);
    showNotification(`Payment of $${amount.toFixed(2)} recorded!`);
  }, [cards, setCards, setPaymentHistory, showNotification]);

  const handleAddCard = useCallback(() => {
    const { name, balance, apr, creditLimit, issuer, dueDate, closeDate } = newCard;
    if (!name.trim() || !validateNumber(balance, 0) || !validateNumber(apr, 0)) {
      showNotification('Please fill all required fields', 'error');
      return;
    }
    setCards(prev => [...prev, { id: Date.now(), name: name.trim(), balance: parseFloat(balance).toFixed(2), creditLimit: creditLimit ? parseFloat(creditLimit).toFixed(2) : '0', apr: parseFloat(apr).toFixed(2), issuer, dueDate, closeDate }]);
    setNewCard({ name: '', balance: '', creditLimit: '', apr: '', issuer: 'chase', dueDate: '', closeDate: '' });
    setIsAdding(false);
    showNotification('Card added!');
  }, [newCard, setCards, showNotification]);

  const handleDeleteCard = useCallback((id) => {
    setCards(prev => prev.filter(c => c.id !== id));
    setShowDeleteConfirm(null);
    showNotification('Card removed');
  }, [setCards, showNotification]);

  const handleExport = useCallback(() => {
    const data = JSON.stringify({ 
      cards, 
      monthlyPaymentBudget, 
      paymentHistory, 
      savingsGoal,
      availableFunds,
      exportDate: new Date().toISOString(), 
      version: '2.2' 
    }, null, 2);
    
    setExportData(data);
    setShowExportModal(true);
  }, [cards, monthlyPaymentBudget, paymentHistory, savingsGoal, availableFunds]);

  const handleImportData = useCallback((data) => {
    try {
      if (data.cards) setCards(data.cards);
      if (data.monthlyPaymentBudget) setMonthlyPaymentBudget(data.monthlyPaymentBudget);
      if (data.paymentHistory) setPaymentHistory(data.paymentHistory);
      if (data.savingsGoal) setSavingsGoal(data.savingsGoal);
      if (data.availableFunds) setAvailableFunds(data.availableFunds);
      showNotification('‚úÖ Data restored successfully!');
    } catch (err) {
      showNotification('‚ùå Failed to restore data', 'error');
    }
  }, [setCards, setMonthlyPaymentBudget, setPaymentHistory, setSavingsGoal, setAvailableFunds, showNotification]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-blue-950/20 scroll-smooth">
      {notification && <Notification message={notification.message} type={notification.type} />}
      <QuickEditModal isOpen={showQuickEdit} onClose={() => setShowQuickEdit(false)} cards={cards} onUpdateBalances={handleUpdateBalances} />
      <FundsManagerModal 
        isOpen={showFundsManager} 
        onClose={() => setShowFundsManager(false)} 
        currentFunds={savingsGoal} 
        availableFunds={availableFunds}
        onUpdateFunds={(newSavings, newAvailable) => { 
          setSavingsGoal(newSavings); 
          setAvailableFunds(newAvailable);
          showNotification('Account balance updated!'); 
        }} 
      />
      <MakePaymentModal isOpen={showMakePayment} onClose={() => setShowMakePayment(false)} cards={cards} onMakePayment={handleMakePayment} />
      <PayoffCalculatorModal isOpen={showCalculator} onClose={() => setShowCalculator(false)} cards={cards} monthlyBudget={monthlyPaymentBudget} setMonthlyBudget={setMonthlyPaymentBudget} totalMinPayment={stats.totalMinPayment} />
      <InsightsModal isOpen={showInsights} onClose={() => setShowInsights(false)} cards={cards} stats={stats} />
      <HistoryModal isOpen={showHistory} onClose={() => setShowHistory(false)} history={paymentHistory} />
      <ExportModal isOpen={showExportModal} onClose={() => setShowExportModal(false)} data={exportData} />
      <ImportModal isOpen={showImportModal} onClose={() => setShowImportModal(false)} onImport={handleImportData} />

      <div className="bg-gradient-to-br from-blue-600 via-cyan-600 to-teal-600 px-6 pt-12 pb-32 shadow-2xl">
        <div className="mb-2">
          <h1 className="text-white text-3xl font-bold tracking-tight">Debt Dash</h1>
          <p className="text-blue-50/90 text-sm mt-1">Your path to financial freedom</p>
        </div>
      </div>

      <div className="max-w-2xl mx-auto px-4 -mt-24 pb-20">
        <div onClick={() => setShowQuickEdit(true)} className="bg-gradient-to-br from-slate-900/98 to-slate-800/98 backdrop-blur-xl rounded-2xl shadow-2xl p-6 mb-6 border border-blue-500/20 hover:border-blue-400/40 hover:shadow-blue-500/10 transition-all group cursor-pointer">
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-3"><div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/30 to-blue-600/20 flex items-center justify-center shadow-lg shadow-blue-500/30 border border-blue-500/20"><TrendingDown className="text-blue-400" size={22} /></div><span className="text-slate-100 font-semibold">Total Debt</span></div>
            <div className="flex items-center gap-2 text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 size={16} /><span className="text-xs">Edit</span></div>
          </div>
          <div className="text-4xl font-bold text-white mb-2">${formatCurrency(stats.totalDebt)}</div>
          <div className="flex items-center justify-between mb-3"><div className="text-sm text-slate-400">{cards.length} card{cards.length !== 1 ? 's' : ''}</div><div className="text-sm text-blue-400 font-semibold">Min: ${stats.totalMinPayment.toFixed(2)}</div></div>
          {parseFloat(savingsGoal) > 0 && <div className="pt-3 border-t border-slate-700/50"><div className="flex items-center justify-between mb-2"><span className="text-slate-400 text-sm">Funds Ready</span><span className="text-teal-400 text-sm font-semibold">-${parseFloat(savingsGoal).toFixed(2)}</span></div><div className="flex items-center justify-between"><span className="text-slate-300 text-sm font-semibold">What I Still Owe</span><span className={`text-lg font-bold ${(stats.totalDebt - parseFloat(savingsGoal)) > 0 ? 'text-amber-400' : 'text-teal-400'}`}>${Math.max(0, stats.totalDebt - parseFloat(savingsGoal)).toFixed(2)}</span></div></div>}
          {stats.totalMonthlyInterest > 0 && <div className="mt-4 pt-4 border-t border-slate-700/50"><div className="flex items-center gap-2 text-amber-400 text-sm"><AlertCircle size={16} /><span>~${stats.totalMonthlyInterest.toFixed(2)}/mo interest ‚Ä¢ ${(stats.totalMonthlyInterest * 12).toFixed(2)}/yr</span></div></div>}
          {stats.overallUtilization > 0 && <div className="mt-3 pt-3 border-t border-slate-700/50"><div className="flex items-center justify-between mb-2"><span className="text-slate-400 text-sm">Utilization</span><span className={`text-sm font-semibold ${stats.overallUtilization > 30 ? 'text-rose-400' : 'text-teal-400'}`}>{stats.overallUtilization.toFixed(1)}%</span></div><div className="w-full bg-slate-700/50 rounded-full h-2.5 shadow-inner"><div className={`h-2.5 rounded-full transition-all shadow-lg ${stats.overallUtilization > 30 ? 'bg-gradient-to-r from-rose-500 to-orange-500 shadow-rose-500/50' : 'bg-gradient-to-r from-teal-500 to-cyan-500 shadow-teal-500/50'}`} style={{ width: `${Math.min(stats.overallUtilization, 100)}%` }} /></div></div>}
        </div>

        <div className="bg-gradient-to-br from-slate-900/98 to-slate-800/98 backdrop-blur-xl rounded-2xl shadow-xl p-6 mb-6 border border-teal-500/20 hover:border-teal-400/30 hover:shadow-teal-500/10 transition-all cursor-pointer group" onClick={() => setShowFundsManager(true)}>
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500/30 to-teal-600/20 flex items-center justify-center shadow-lg shadow-teal-500/30 border border-teal-500/20"><Wallet className="text-teal-400" size={20} /></div>
              <div>
                <span className="text-slate-100 font-semibold block">Account Balance</span>
                <span className="text-xs text-slate-400">Track your funds</span>
              </div>
            </div>
            <div className="flex items-center gap-2 text-teal-400 opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 size={16} /><span className="text-xs">Edit</span></div>
          </div>
          <div className="grid grid-cols-2 gap-4" onClick={(e) => e.stopPropagation()}>
            <div>
              <label className="text-xs text-slate-400 block mb-2">For Debt Payment</label>
              <div className="text-2xl font-bold text-white">${parseFloat(savingsGoal || 0).toFixed(2)}</div>
            </div>
            <div>
              <label className="text-xs text-slate-400 block mb-2">Total Available</label>
              <div className="text-2xl font-bold text-white">${parseFloat(availableFunds || 0).toFixed(2)}</div>
            </div>
          </div>
          {parseFloat(availableFunds || 0) > 0 && (
            <div className="mt-4 pt-4 border-t border-slate-700/50">
              <div className="flex items-center justify-between mb-3">
                <span className="text-slate-400 text-sm">Free to Spend</span>
                <span className={`text-lg font-bold ${(parseFloat(availableFunds || 0) - parseFloat(savingsGoal || 0)) >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                  ${Math.max(0, parseFloat(availableFunds || 0) - parseFloat(savingsGoal || 0)).toFixed(2)}
                </span>
              </div>
              {parseFloat(savingsGoal || 0) > 0 && (
                <button 
                  onClick={(e) => { e.stopPropagation(); setShowMakePayment(true); }} 
                  className="w-full bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 text-white py-3 rounded-xl font-semibold flex items-center justify-center gap-2 shadow-lg transition-all"
                >
                  <DollarSign size={20} />
                  Make a Payment
                </button>
              )}
            </div>
          )}
        </div>

        <div className="grid grid-cols-2 gap-3 mb-20">
          <button onClick={() => setShowCalculator(true)} className="bg-gradient-to-br from-slate-900/98 to-slate-800/98 backdrop-blur-xl hover:from-slate-850 hover:to-slate-800 text-white p-4 rounded-xl border border-blue-500/20 hover:border-blue-400/40 hover:shadow-blue-500/10 transition-all shadow-lg" title="Calculate payoff timelines and compare debt strategies"><div className="flex items-center gap-2 mb-2"><Calculator size={18} className="text-blue-400" /><span className="text-sm font-semibold text-slate-100">Calculator</span></div><div className="text-xs text-slate-400">Plan payoff</div></button>
          <button onClick={() => setShowInsights(true)} className="bg-gradient-to-br from-slate-900/98 to-slate-800/98 backdrop-blur-xl hover:from-slate-850 hover:to-slate-800 text-white p-4 rounded-xl border border-cyan-500/20 hover:border-cyan-400/40 hover:shadow-cyan-500/10 transition-all shadow-lg" title="View detailed insights, calendar, and financial tips"><div className="flex items-center gap-2 mb-2"><BarChart3 size={18} className="text-cyan-400" /><span className="text-sm font-semibold text-slate-100">Insights</span></div><div className="text-xs text-slate-400">Analysis</div></button>
        </div>

        {isAdding && <div className="bg-slate-800/90 backdrop-blur-xl rounded-2xl shadow-xl p-6 mb-6 border border-slate-700/50"><div className="flex items-center justify-between mb-5"><h3 className="font-bold text-white text-lg">Add New Card</h3><button onClick={() => setIsAdding(false)} className="text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-700/50 transition-colors"><X size={20} /></button></div><div className="space-y-4"><input type="text" placeholder="Card Name (e.g., Chase Freedom)" value={newCard.name} onChange={(e) => setNewCard(prev => ({ ...prev, name: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-slate-500" /><select value={newCard.issuer} onChange={(e) => setNewCard(prev => ({ ...prev, issuer: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white"><option value="chase">Chase</option><option value="navyfed">Navy Federal</option><option value="discover">Discover</option><option value="other">Other</option></select><input type="number" placeholder="Current Balance" value={newCard.balance} onChange={(e) => setNewCard(prev => ({ ...prev, balance: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-slate-500" step="0.01" /><input type="number" placeholder="Credit Limit" value={newCard.creditLimit} onChange={(e) => setNewCard(prev => ({ ...prev, creditLimit: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-slate-500" step="0.01" /><input type="number" placeholder="APR % (e.g., 18.99)" value={newCard.apr} onChange={(e) => setNewCard(prev => ({ ...prev, apr: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder-slate-500" step="0.01" /><div className="grid grid-cols-2 gap-3"><div><label className="text-xs text-slate-400 mb-1 block">Payment Due Date</label><input type="date" value={newCard.dueDate} onChange={(e) => setNewCard(prev => ({ ...prev, dueDate: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white" /></div><div><label className="text-xs text-slate-400 mb-1 block">Statement Close Date</label><input type="date" value={newCard.closeDate} onChange={(e) => setNewCard(prev => ({ ...prev, closeDate: e.target.value }))} className="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white" /></div></div><div className="flex gap-3 pt-2"><button onClick={handleAddCard} className="flex-1 bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-700 hover:to-teal-700 text-white py-3 rounded-xl font-semibold transition-all">Add Card</button><button onClick={() => setIsAdding(false)} className="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-semibold transition-all">Cancel</button></div></div></div>}

        {cards.length > 0 && <div className="space-y-3 mb-6">{cards.map((card, i) => <CardItem key={card.id} card={card} index={i} onToggle={(id) => setExpandedCard(expandedCard === id ? null : id)} isExpanded={expandedCard === card.id} onDelete={setShowDeleteConfirm} showDeleteConfirm={showDeleteConfirm} onConfirmDelete={handleDeleteCard} />)}</div>}

        {cards.length === 0 && !isAdding && (
          <div className="bg-gradient-to-br from-slate-900/50 to-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl p-12 mb-6 border border-slate-700/30 text-center">
            <div className="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center border border-blue-500/30">
              <Plus className="text-blue-400" size={32} />
            </div>
            <h3 className="text-xl font-bold text-white mb-2">Start Your Debt Journey</h3>
            <p className="text-slate-400 mb-6 max-w-md mx-auto">Add your first credit card to begin tracking your path to financial freedom</p>
            <button 
              onClick={() => setIsAdding(true)} 
              className="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-6 py-3 rounded-xl font-semibold inline-flex items-center gap-2 shadow-xl transition-all"
            >
              <Plus size={20} />
              Add Your First Card
            </button>
          </div>
        )}

        <div className="pb-8"><div className="flex gap-3 mb-3"><button onClick={handleExport} className="flex-1 flex items-center justify-center gap-2 bg-slate-800/90 hover:bg-slate-700 text-slate-300 px-4 py-3 rounded-xl font-medium border border-slate-700/50 transition-colors"><Download size={18} />Export</button><button onClick={() => setShowImportModal(true)} className="flex-1 flex items-center justify-center gap-2 bg-slate-800/90 hover:bg-slate-700 text-slate-300 px-4 py-3 rounded-xl font-medium border border-slate-700/50 transition-colors"><Upload size={18} />Import</button></div>{!isAdding && <button onClick={() => setIsAdding(true)} className="w-full bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-700 hover:to-teal-700 text-white py-4 rounded-xl font-semibold flex items-center justify-center gap-2 shadow-xl transition-all"><Plus size={20} />Add Credit Card</button>}</div>

        <div className="text-center pt-8 pb-4 border-t border-slate-800/50">
          <p className="text-slate-500 text-xs mb-2">
            All data stored locally on your device ‚Ä¢ No servers ‚Ä¢ Complete privacy
          </p>
          <p className="text-slate-600 text-xs">
            Debt Dash v2.2 ‚Ä¢ Banking-grade calculations
          </p>
        </div>
      </div>
    </div>
  );
}

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DebtDash />);
  </script>
</body>
</html>
